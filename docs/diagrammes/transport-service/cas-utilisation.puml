@startuml Transport Service - Cas d'Utilisation

title Transport Service - Cas d'Utilisation

left to right direction

' Acteurs
actor "Client" as Client
actor "Commerçant\n(Compagnie Transport)" as Merchant
actor "Chauffeur VTC" as Driver
actor "Administrateur" as Admin
actor "Booking Service" as BookingService
actor "Resource Core" as ResourceCore

' Package Transport Service
rectangle "Transport Service" {
    ' Cas d'utilisation principaux
    usecase "Gérer véhicules" as UC1
    usecase "Gérer trajets" as UC2
    usecase "Gérer places" as UC3
    usecase "Rechercher trajets" as UC4
    usecase "Vérifier disponibilité" as UC5
    usecase "Gérer chauffeurs" as UC6
    usecase "Gérer lignes" as UC7
    usecase "Consulter horaires" as UC8

    ' Sous-cas pour gestion véhicules
    usecase "Créer véhicule" as UC1_1
    usecase "Modifier véhicule" as UC1_2
    usecase "Activer/Désactiver véhicule" as UC1_3
    usecase "Définir capacité" as UC1_4
    usecase "Ajouter équipements" as UC1_5
    usecase "Gérer maintenance" as UC1_6
    usecase "Associer chauffeur" as UC1_7

    ' Sous-cas pour gestion trajets
    usecase "Créer trajet" as UC2_1
    usecase "Planifier horaires" as UC2_2
    usecase "Définir arrêts" as UC2_3
    usecase "Calculer distance" as UC2_4
    usecase "Calculer durée" as UC2_5
    usecase "Définir tarifs" as UC2_6
    usecase "Annuler trajet" as UC2_7
    usecase "Modifier trajet" as UC2_8

    ' Sous-cas pour gestion places
    usecase "Générer places automatiquement" as UC3_1
    usecase "Créer place manuelle" as UC3_2
    usecase "Définir classes" as UC3_3
    usecase "Définir tarifs places" as UC3_4
    usecase "Activer/Désactiver place" as UC3_5
    usecase "Gérer plan siège" as UC3_6

    ' Sous-cas pour recherche
    usecase "Rechercher par origine/destination" as UC4_1
    usecase "Filtrer par date" as UC4_2
    usecase "Filtrer par type transport" as UC4_3
    usecase "Filtrer par classe" as UC4_4
    usecase "Filtrer par compagnie" as UC4_5
    usecase "Trier résultats" as UC4_6
    usecase "Afficher suggestions" as UC4_7

    ' Sous-cas pour disponibilité
    usecase "Vérifier place spécifique" as UC5_1
    usecase "Obtenir places disponibles" as UC5_2
    usecase "Vérifier véhicule complet" as UC5_3
    usecase "Bloquer place temporairement" as UC5_4
    usecase "Libérer place" as UC5_5
    usecase "Mettre cache à jour" as UC5_6

    ' Sous-cas pour chauffeurs
    usecase "Enregistrer chauffeur" as UC6_1
    usecase "Valider permis" as UC6_2
    usecase "Gérer notes" as UC6_3
    usecase "Attribuer véhicule" as UC6_4
    usecase "Consulter historique courses" as UC6_5
    usecase "Gérer disponibilités" as UC6_6
    usecase "Suspendre chauffeur" as UC6_7

    ' Sous-cas pour lignes
    usecase "Créer ligne" as UC7_1
    usecase "Définir itinéraire" as UC7_2
    usecase "Ajouter arrêts" as UC7_3
    usecase "Définir fréquences" as UC7_4
    usecase "Définir tarifs ligne" as UC7_5
    usecase "Associer véhicules" as UC7_6

    ' Sous-cas pour horaires
    usecase "Consulter prochains départs" as UC8_1
    usecase "Consulter arrivées prévues" as UC8_2
    usecase "Consulter retards" as UC8_3
    usecase "Recevoir alertes" as UC8_4
}

' Relations acteurs -> cas d'utilisation
Client --> UC4 : recherche trajets
Client --> UC5 : vérifie disponibilité
Client --> UC8 : consulte horaires

Merchant --> UC1 : gère sa flotte
Merchant --> UC2 : planifie trajets
Merchant --> UC3 : configure places
Merchant --> UC6 : gère chauffeurs (VTC)
Merchant --> UC7 : gère lignes

Driver --> UC6_5 : consulte historique
Driver --> UC6_6 : gère disponibilités
Driver --> UC2 : consulte trajets assignés

Admin --> UC1 : supervise véhicules
Admin --> UC2 : supervise trajets
Admin --> UC6_7 : suspend chauffeurs

BookingService --> UC5 : vérifie avant réservation
BookingService --> UC5_4 : bloque place lors réservation
BookingService --> UC5_5 : libère place si annulation

ResourceCore --> UC1 : valide ressource véhicule
ResourceCore --> UC6 : valide ressource chauffeur

' Inclusions et extensions
UC1 ..> UC1_1 : <<extend>>
UC1 ..> UC1_2 : <<extend>>
UC1 ..> UC1_3 : <<extend>>
UC1 ..> UC1_4 : <<include>>
UC1 ..> UC1_5 : <<extend>>
UC1 ..> UC1_6 : <<extend>>
UC1 ..> UC1_7 : <<extend>>\n[si VTC]

UC2 ..> UC2_1 : <<extend>>
UC2 ..> UC2_2 : <<include>>
UC2 ..> UC2_3 : <<include>>
UC2 ..> UC2_4 : <<include>>
UC2 ..> UC2_5 : <<include>>
UC2 ..> UC2_6 : <<include>>
UC2 ..> UC2_7 : <<extend>>
UC2 ..> UC2_8 : <<extend>>

UC3 ..> UC3_1 : <<extend>>\n[si bus/train]
UC3 ..> UC3_2 : <<extend>>\n[si avion/VTC]
UC3 ..> UC3_3 : <<include>>
UC3 ..> UC3_4 : <<include>>
UC3 ..> UC3_5 : <<extend>>
UC3 ..> UC3_6 : <<extend>>

UC4 ..> UC4_1 : <<include>>
UC4 ..> UC4_2 : <<include>>
UC4 ..> UC4_3 : <<extend>>
UC4 ..> UC4_4 : <<extend>>
UC4 ..> UC4_5 : <<extend>>
UC4 ..> UC4_6 : <<extend>>
UC4 ..> UC4_7 : <<extend>>\n[si indisponible]

UC5 ..> UC5_1 : <<extend>>
UC5 ..> UC5_2 : <<include>>
UC5 ..> UC5_3 : <<extend>>
UC5 ..> UC5_4 : <<extend>>
UC5 ..> UC5_5 : <<extend>>
UC5 ..> UC5_6 : <<include>>

UC6 ..> UC6_1 : <<extend>>
UC6 ..> UC6_2 : <<include>>\n[si nouveau]
UC6 ..> UC6_3 : <<extend>>
UC6 ..> UC6_4 : <<extend>>
UC6 ..> UC6_5 : <<extend>>
UC6 ..> UC6_6 : <<extend>>
UC6 ..> UC6_7 : <<extend>>

UC7 ..> UC7_1 : <<extend>>
UC7 ..> UC7_2 : <<include>>
UC7 ..> UC7_3 : <<include>>
UC7 ..> UC7_4 : <<extend>>
UC7 ..> UC7_5 : <<include>>
UC7 ..> UC7_6 : <<extend>>

UC8 ..> UC8_1 : <<extend>>
UC8 ..> UC8_2 : <<extend>>
UC8 ..> UC8_3 : <<extend>>
UC8 ..> UC8_4 : <<extend>>

' Notes explicatives
note right of UC1
  Types de véhicules supportés:

  BUS:
  - Capacité: 30-70 places
  - Classes: Économique, Business
  - Équipements: Climatisation, Wi-Fi, USB
  - Numérotation: Rangées de 4

  TRAIN:
  - Capacité: 100-500 places
  - Classes: Économique, Business, Première
  - Équipements: Wagon restaurant, couchettes
  - Numérotation: Par voiture et siège

  AVION:
  - Capacité: 50-300 places
  - Classes: Économique, Business, Première
  - Équipements: Divertissement, repas
  - Numérotation: Rangées A-F

  METRO:
  - Capacité: 200-400 places
  - Classes: Standard
  - Équipements: Debout autorisé
  - Numérotation: Pas de places fixes

  VTC:
  - Capacité: 1-8 places
  - Classes: Standard, Confort, Luxe
  - Équipements: Climatisation, eau
  - Réservation: Véhicule complet
end note

note right of UC2
  Création trajet automatisée:

  Étapes:
  1. Commerçant sélectionne véhicule
  2. Définit ligne (origine → destination)
  3. Ajoute arrêts intermédiaires
  4. Définit heure départ
  5. Système calcule:
     - Distance (formule Haversine GPS)
     - Durée (distance/vitesse + arrêts)
     - Heure arrivée
     - Heures arrêts intermédiaires
  6. Génère automatiquement places
  7. Publie trajet disponible

  Exemple Dakar → Thiès:
  - Distance: 70 km (GPS)
  - Vitesse moyenne: 60 km/h
  - Durée brute: 1h10
  - Arrêts (3 × 5min): 15min
  - Marge trafic: 5min
  - Durée totale: 1h30

  Arrêts:
  1. Départ Dakar: 08:00
  2. Rufisque: 08:20
  3. Diamniadio: 08:45
  4. Sébikotane: 09:00
  5. Arrivée Thiès: 09:30
end note

note right of UC3
  Génération automatique places:

  Bus 50 places:
  - Places 1-40: Classe ECONOMIQUE (2500 XOF)
  - Places 41-50: Classe BUSINESS (4000 XOF)

  Répartition:
  - Rangées de 4 (2 de chaque côté)
  - Numéros impairs: côté fenêtre gauche
  - Numéros pairs: côté couloir/fenêtre droite

  Plan:
  ```
  Chauffeur  |  Couloir
  ---------------------
  1  2  | |  3  4      ← Rangée 1
  5  6  | |  7  8      ← Rangée 2
  9  10 | | 11 12      ← Rangée 3
  ...
  41 42 | | 43 44      ← BUSINESS
  ```

  Train 200 places:
  - Voiture 1-4: Économique (150 places)
  - Voiture 5-6: Business (50 places)
  - Numérotation: V1-S1, V1-S2, ..., V6-S50

  Avion 150 places:
  - Rangées 1-5: Première (30 places, A-F)
  - Rangées 6-10: Business (30 places)
  - Rangées 11-25: Économique (90 places)

  VTC:
  - Pas de places fixes
  - Réservation véhicule complet
  - Tarif à la course ou km
end note

note bottom of UC4
  Recherche intelligente:

  Critères:
  - Origine (ville GPS)
  - Destination (ville GPS)
  - Date départ
  - Nombre passagers
  - Type transport (optionnel)
  - Classe (optionnel)

  Algorithme:
  1. Recherche trajets exacts
  2. Calcule disponibilités
  3. Trie par:
     - Heure départ (croissant)
     - Prix (croissant)
     - Durée (croissant)
     - Notes compagnie (décroissant)
  4. Filtre selon préférences

  Cache Redis:
  - Clé: "search:{origine}:{dest}:{date}"
  - TTL: 5 minutes
  - Invalidation si nouveau trajet créé

  Performance:
  - <100ms avec cache
  - <500ms sans cache
  - Pagination: 20 résultats/page

  Suggestions si aucun résultat:
  - Trajets veille/lendemain
  - Trajets villes proches (<50km)
  - Trajets avec correspondance
end note

note right of UC5
  Disponibilité temps réel:

  Statuts places:
  - DISPONIBLE: libre réservation
  - BLOQUEE: réservation en cours (15min)
  - RESERVEE: payée et confirmée
  - HORS_SERVICE: maintenance/problème

  Cache Redis (10min):
  ```json
  {
    "trajetId": "trip-123",
    "capaciteTotale": 50,
    "placesDisponibles": 38,
    "placesByClasse": {
      "ECONOMIQUE": 32,
      "BUSINESS": 6
    },
    "lastUpdate": "2026-03-15T08:15:00Z"
  }
  ```

  Invalidation cache:
  - Nouvelle réservation
  - Annulation réservation
  - Modification trajet

  Blocage temporaire:
  - Durée: 15 minutes
  - Empêche double réservation
  - Libération auto si paiement échoue
  - Extension possible (1 fois max)

  Vérification:
  1. Cache Redis (priorité)
  2. Si cache miss → DB PostgreSQL
  3. Appel Booking Service (réservations)
  4. Calcul disponibilités
  5. Mise à jour cache
end note

note right of UC6
  Gestion chauffeurs VTC:

  Enregistrement:
  - Nom, prénom, téléphone
  - Photo profil
  - Permis de conduire (photo + validité)
  - Casier judiciaire
  - Assurance véhicule

  Validation:
  - Vérification permis (validité)
  - Vérification assurance (active)
  - Formation obligatoire
  - Test conduite (optionnel)

  Notes et évaluations:
  - Note moyenne sur 5
  - Commentaires clients
  - Nombre courses effectuées
  - Taux annulation
  - Temps réponse moyen

  Disponibilités:
  - Agenda créneaux disponibles
  - Acceptation courses automatique/manuelle
  - Mode hors ligne
  - Pause/Fin journée

  Historique:
  - Toutes courses effectuées
  - Revenus générés
  - Statistiques (km, durée, clients)
  - Incidents signalés

  Suspension:
  - Note <3 pendant 20 courses
  - Annulation >30%
  - Incident grave client
  - Permis/assurance expirés
end note

note bottom of UC7
  Lignes de transport:

  Définition ligne:
  - Code ligne (ex: L12, TGV-123)
  - Nom ligne (Dakar - Saint-Louis)
  - Type transport
  - Origine (ville + GPS)
  - Destination (ville + GPS)
  - Arrêts intermédiaires (ordre séquentiel)

  Itinéraire:
  - Distance totale (GPS)
  - Durée moyenne
  - Points GPS pour tracer carte
  - Infrastructure (routes, rails, etc.)

  Fréquences:
  - Horaires réguliers (ex: toutes les 2h)
  - Jours de circulation (lun-dim)
  - Horaires spéciaux (ramadan, fêtes)
  - Saisonnalité (haute/basse saison)

  Tarifs:
  - Par classe
  - Par segment (arrêt à arrêt)
  - Réductions (enfant, étudiant, senior)
  - Abonnements (mensuel, annuel)

  Véhicules associés:
  - Liste véhicules opérant ligne
  - Rotation véhicules
  - Maintenance préventive
  - Remplacement si panne

  Exemples lignes Sénégal:
  - L01: Dakar → Thiès (70 km, 1h30)
  - L02: Dakar → Saint-Louis (270 km, 4h)
  - L03: Dakar → Ziguinchor (450 km, 8h)
  - TER: Dakar → AIBD (55 km, 45min)
end note

note right of UC8
  Consultation horaires:

  Prochains départs:
  - Par gare/station
  - Prochaines 24h
  - Filtre par destination
  - État (à l'heure, retard, annulé)

  Arrivées prévues:
  - Heure prévue initiale
  - Heure estimée en temps réel
  - Calcul ETA dynamique (GPS)
  - Notification si changement >15min

  Gestion retards:
  - Détection automatique (GPS)
  - Notification passagers concernés
  - Proposition alternatives
  - Compensation si retard >2h

  Alertes:
  - Départ imminent (15min avant)
  - Changement quai/porte
  - Annulation trajet
  - Incidents sur ligne
  - Conditions météo

  Affichage:
  - Tableaux horaires gare
  - App mobile temps réel
  - Écrans embarqués
  - SMS/Email sur demande

  Intégration:
  - Google Maps
  - Plans transport en commun
  - Calcul itinéraires multimodaux
end note

' Contraintes
note "Permis de conduire valide\nobligatoire pour chauffeurs VTC" as N1
UC6 .. N1

note "Distance calculée par GPS\n(formule Haversine)" as N2
UC2_4 .. N2

note "Places générées automatiquement\nselon type véhicule" as N3
UC3_1 .. N3

note "Cache Redis invalidé\nà chaque réservation" as N4
UC5_6 .. N4

note "Blocage place max 15min\nsans paiement" as N5
UC5_4 .. N5

note "Recherche limitée\nà 6 mois dans le futur" as N6
UC4 .. N6

@enduml
